#!/usr/bin/env node
const SolidClient = require('../src/SolidClient');

// Parse the command-line arguments
const args = process.argv.slice(2);
if (args.length !== 4)
  die('Usage: solid-bearer-token identity_provider username password url');
const [identityProvider, username, password, url] = args;

// Obtain a token
getToken({ identityProvider, username, password, url }).then(console.log, die);

// Obtains a token
async function getToken({ identityProvider, username, password, url }) {
  const client = new SolidClient();
  const session = await client.login(identityProvider, { username, password });
  const token = await client.createToken(url, session);
  return token;
}

// Terminates the process with the given error
function die(error) {
  console.error(error);
  process.exit(1);
}
